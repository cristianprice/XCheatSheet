#Valgrind

##Callgrind

[Official Manual](http://valgrind.org/docs/manual/cl-manual.html)

Callgrind generates a **call-graph**, showing caller-callee relationships, counting functions calls and counting Ir (instruction references) (by default). It can also simulate cache misses and branch predictions, by setting command line flags.

```bash
valgrind --tool=callgrind ./myapp
```

It will generate a profile file like *callgrind.out.4990*. The session number may change.

###Profiling only selected piece of code

Insert the macros in your source code:

```cpp
#include  <valgrind/callgrind.h>

//code before

CALLGRIND_START_INSTRUMENTATION;
//the meat
//...
CALLGRIND_STOP_INSTRUMENTATION;
CALLGRIND_DUMP_STATS;

//code after
```

On the command line, start profiling with

```bash
 valgrind --tool=callgrind --instr-atstart=no ./myapp
```

###Visualizing profile with *kcachegrind*

**Kcachegrind** is a GUI that display the profile generated by valgrind.
```bash
kcachegrind callgrind.out.4990
```

###Invoke debugger when error occurs
```
valgrind --db-attach=yes ./myapp
```
This will launch **gdb** when valgrind encounters an error.
